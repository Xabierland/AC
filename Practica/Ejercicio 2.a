ESTADO EQU R0
EVENTO EQU R1
NA EQU 0X2F.0
NB EQU 0X2F.1
EV1 EQU P1.4
EV2 EQU P1.5
SA EQU P1.1
SB EQU P1.0

org 0x00
AJMP INICIO

ORG 0X80
INICIO:
	MOV ESTADO,0X00
PRINCIPAL:
	ACALL GEV
	ACALL FSM
	AJMP PRINCIPAL

GEV:
	JB SA ,10
	MOV EVENTO,1
	RET
	JNB SB,26
	MOV EVENTO,2
	RET
	MOV EVENTO,3
	RET



FSM:
	MOV A, ESTADO
	RL A

	MOV DPTR,#EST_TBL
	JMP @A+DPTR

EST_TBL:
	AJMP ESTADO0 
	AJMP ESTADO1
	AJMP ESTADO2

ESTADO0:
	MOV A, EVENTO
	RL A

	MOV DPTR,#EV0_TBL
	JMP @A+DPTR

EV0_TBL:
	AJMP EV00
	AJMP EV01
	AJMP EV02
	AJMP EV03


ESTADO1:
	MOV A, EVENTO
	RL A
	
	MOV DPTR,#EV1_TBL
	JMP @A+DPTR

EV1_TBL:
	AJMP EV00
	AJMP EV11
	AJMP EV12
	AJMP EV13
	
	

ESTADO2:
	MOV A, EVENTO
	RL A

	MOV DPTR,#EV2_TBL
	JMP @A+DPTR

EV2_TBL:
	AJMP EV00
	AJMP EV21
	AJMP EV22
	AJMP EV23

EV00:
	RET
EV01:
	ACALL CERRAR_ENTRADA
	MOV ESTADO,1
	RET
EV02:
	RET
EV03:
	ACALL CERRAR_SALIDA
	MOV ESTADO,2
	RET


EV11:
	RET
EV12:
	ACALL ABRIR_AMBAS
	MOV ESTADO,0
	RET
EV13:
	RET
EV21:
	ACALL ABRIR_AMBAS
	MOV ESTADO,0
	RET
EV22:
	RET
EV23:
	RET

CERRAR_ENTRADA:
	CLR EV1
	RET
CERRAR_SALIDA:
	CLR EV2
	RET
ABRIR_AMBAS:
	SETB EV1
	SETB EV2
	RET 


FINAL:

LABEL:

END

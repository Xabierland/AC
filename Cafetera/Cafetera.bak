;********************************VARIABLES GLOBALES
ESTADO		EQU 	R7
EVENTO		EQU	R6
DISPLAY1	EQU 	0x30
DISPLAY2	EQU 	0x31
;********************************VARIABLES VASO
P_HAY_VASO	EQU	P3.1
SN_PONER_VASO	EQU	P1.3
NO_ESTA_VASO	EQU	0X20.0
;********************************VARIABLES AGUA
P_LLENO_AGUA	EQU	P3.0
P_LLENAR_AGUA	EQU 	P0.7
ESTA_VACIO	EQU	0X21.0

;**********************************************INIT INSTRUCCION 0X00
ORG 0x00
	AJMP MAIN

;INTERRUPCIONES

;PROGRAMA PRINCIPAL
ORG 0x7B
MAIN:
	ACALL INIT

LOOP:
	ACALL MAQ_EST
	AJMP LOOP

INIT:
	MOV ESTADO,#0X02
	MOV EVENTO,#0X00
	CLR SN_PONER_VASO
	SETB NO_ESTA_VASO
	CLR P_LLENAR_AGUA
	SETB ESTA_VACIO

	RET

;**********************************************MAQUINA DE ESTADOS
MAQ_EST:
	MOV A, ESTADO
	RL A
	MOV DPTR, #TABLAESTADO
	JMP @A+DPTR
TABLAESTADO:
	AJMP ESPERA		;#0X00
	AJMP PONER_VASO		;#0X01
;	AJMP ECHAR_CAFE		;#0X02
;	AJMP MOLER_CAFE		;#0X03
	AJMP ECHAR_AGUA		;#0X04	



;**********************************************ESTADO 0: ESPERA
ESPERA:
	RET

;**********************************************ESTADO 1: PONER_VASO
PONER_VASO:
	ACALL E2_GENERADOR_EVENTOS
	MOV A, EVENTO
	RL A
	MOV DPTR, #TABLA_E1_EVENTOS
	JMP @A+DPTR

TABLA_E1_EVENTOS:
	AJMP E1_EVENTO_0
	AJMP E1_EVENTO_1
	AJMP E1_EVENTO_2

E1_GENERADOR_EVENTOS:
	JB P_HAY_VASO, E1_PASAR_SIG_ESTADO
	JB NO_ESTA_VASO, E1_PONER_VASO
	MOV EVENTO, #0X00
	RET

E1_PONER_VASO:
	MOV EVENTO, #0X02
	CLR NO_ESTA_VASO
	RET

E1_PASAR_SIG_ESTADO:
	MOV EVENTO, #0X01
	RET

E1_EVENTO_0:
	RET

E1_EVENTO_1:
	MOV ESTADO, #0X02
	CLR SN_PONER_VASO
	;ENCENDER MOLINILLO
	;PROGRAMAR TIMER
	RET

E1_EVENTO_2:
	SETB SN_PONER_VASO
	RET


;**********************************************ESTADO 4: ECHAR AGUA
ECHAR_AGUA:
	ACALL E2_GENERADOR_EVENTOS
	MOV A, EVENTO
	RL A
	MOV DPTR, #TABLA_E2_EVENTOS
	JMP @A+DPTR
TABLA_E2_EVENTOS:
	AJMP E1_EVENTO_0
	AJMP E1_EVENTO_1
	AJMP E1_EVENTO_2

E2_GENERADOR_EVENTOS:
	JB P_LLENO_AGUA, E2_PASAR_SIG_ESTADO
	JB ESTA_VACIO, E2_ECHAR_AGUA
	MOV EVENTO, #0X00
	RET

E2_ECHAR_AGUA:
	MOV EVENTO, #0X02
	CLR ESTA_VACIO
	RET

E2_PASAR_SIG_ESTADO:
	MOV EVENTO, #0X01
	RET

E2_EVENTO_0:
	RET

E2_EVENTO_1:
	MOV ESTADO, #0X05
	CLR P_LLENAR_AGUA
	RET

E2_EVENTO_2:
	SETB P_LLENAR_AGUA
	RET



END


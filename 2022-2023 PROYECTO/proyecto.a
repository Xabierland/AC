ESTADO EQU 0x20
EVENTO EQU 0x21

VALOR_DISPLAY EQU 0x22

LED EQU P2.0
ZUMBADOR EQU P2.1

PLUS EQU P3.0
MINUS EQU P3.1
SWITCH EQU P3.2
SENSOR EQU P3.3
;TERMOMETRO EQU P5.0


ORG 0X0000
	AJMP INICIO

ORG 0x007b
INICIO:
	ACALL INIT
MAIN:
	ACALL FSM
	AJMP MAIN
FSM:
	MOV A, ESTADO
	RL A
	MOV DPTR, #EST_TAB
	JMP @A+DPTR
EST_TAB:
	AJMP ESTADO0		;REPOSO
	AJMP ESTADO1		;ESPERA
	AJMP ESTADO2		;CALENTAR
	AJMP ESTADO3		;TRANSICION
;========================INIT=====================;
INIT:
	;VALORES INICIALES
	MOV ESTADO, #0
	MOV EVENTO, #0
	MOV VALOR_DISPLAY, #0
	;PUERTOS ENTRADA
	SETB PLUS
	SETB MINUS
	SETB SWITCH
	SETB SENSOR
	;SETB TERMOMETRO
	;PUERTOS SALIDA
	CLR P0.0
	CLR P0.1
	CLR P0.2
	CLR P0.3
	CLR P0.4
	CLR P0.5
	CLR P0.6
	CLR P0.7
	CLR LED
	CLR ZUMBADOR
	RET
;===================ESTADO0_REPOSO================;
ESTADO0:
	ACALL ES0_GEN_EV
	MOV A, EVENTO
	RL A
	MOV DPTR, #ES0_EV_TAB
	JMP @A+DPTR
ES0_EV_TAB:
	AJMP ES0_EV0		;EVENTO VACIO
	AJMP ES0_EV1		;ENCENDIDO
ES0_EV0:
	RET
ES0_EV1:
	;PONER UN 0 EN PANTALLA
	MOV VALOR_DISPLAY, #0
	ACALL UPDATE_DISPLAY
	;LED ON

	;ZUMBIDO ON
	
	;CAMBIAR AL ESTADO 1
	MOV ESTADO, #1
	;CAMBIAR EL EVENTO AL 0
	MOV EVENTO, #0
	RET
ES0_GEN_EV:
	MOV C, SWITCH
	JC ES0_PULSADOR
	RET
ES0_PULSADOR:
	MOV EVENTO, #1
	RET
;====================ESTADO1_ESPERA================
ESTADO1:
	ACALL ES1_GEN_EV
	MOV A, EVENTO
	RL A
	MOV DPTR, #ES1_EV_TAB
	JMP @A+DPTR
ES1_EV_TAB:
	AJMP ES1_EV0
	AJMP ES1_EV1
ES1_EV0:
	RET
ES1_EV1:
	RET
ES1_GEN_EV:
	RET
;===================ESTADO2_CALENTAR===============
ESTADO2:
;==================ESTADO3_TRANSICION==============
ESTADO3:
;=======================DISPLAY====================
UPDATE_DISPLAY:
	MOV A, VALOR_DISPLAY
	RL A
	MOV DPTR, #DISPLAY_FUNC
	JMP @A+DPTR
DISPLAY_FUNC:
	AJMP DISPLAY_0	;0
	AJMP DISPLAY_1	;1
	AJMP DISPLAY_2	;2
	AJMP DISPLAY_3	;3
	AJMP DISPLAY_4	;4
	AJMP DISPLAY_5	;5
	AJMP DISPLAY_6	;6
	AJMP DISPLAY_7	;7
	AJMP DISPLAY_8	;8
	AJMP DISPLAY_9	;9
	AJMP DISPLAY_H	;10
	AJMP DISPLAY_HH	;11
DISPLAY_0:	;*gfedcba
	ORL P0, #00111111b
	RET
DISPLAY_1:
	ORL P0, #00000110b
	RET
DISPLAY_2:
	ORL P0, #01011011b
	RET
DISPLAY_3:
	ORL P0, #01001111b
	RET
DISPLAY_4:
	ORL P0, #01111111b
	RET
DISPLAY_5:
	ORL P0, #01101101b
	RET
DISPLAY_6:
	ORL P0, #01111101b
	RET
DISPLAY_7:
	ORL P0, #00001111b
	RET
DISPLAY_8:
	ORL P0, #01111111b
	RET
DISPLAY_9:
	ORL P0, #01101111b
	RET
DISPLAY_H:
	ORL P0, #01110100b
	RET
DISPLAY_HH:
	ORL P0, #01110110b
	RET
;========================END======================
END

A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     1


MACRO ASSEMBLER A51 V6.14
OBJECT MODULE PLACED IN .\proyecto.OBJ
ASSEMBLER INVOKED BY: C:\Keil\C51\BIN\A51.EXE .\proyecto.a SET(SMALL) DEBUG EP

LOC  OBJ            LINE     SOURCE

                       1     ;VARIABLES GLOBALES
  0020                 2     ESTADO EQU 0x20
  0021                 3     EVENTO EQU 0x21
  0022                 4     VALOR_DISPLAY EQU 0x22
  0023                 5     T_CONT1 EQU 0x23
  0024                 6     T_CONT2 EQU 0x24
  0028                 7     TICK EQU 0x25.0
  0029                 8     PARPADEO EQU 0x25.1
  002A                 9     FADC EQU 0X25.2
  0026                10     CONT_ZUMB EQU 0x26
  0027                11     CONT_PARPADEO EQU 0x27  
                      12     
                      13     ;PCON EQU 0x87
  00C5                14     ADCON EQU 0xC5
  00FE                15     ADCH EQU 0xFE
  00FE                16     PWMP EQU 0xFE
  00FC                17     PWM0 EQU 0xFC
  00A8                18     IEN0 EQU 0xA8
                      19     
                      20     ;PUERTOS
  00A0                21     LED EQU P2.0
  00A1                22     ZUMBADOR EQU P2.1
  00B0                23     PLUS EQU P3.0
  00B1                24     MINUS EQU P3.1
  00B2                25     SWITCH EQU P3.2
  00B5                26     SENSOR EQU P3.5
                      27     
                      28     ;VARIABLES DE ESTADOS
                      29             ;1
  002A                30     ES1_CONT_MS EQU 0x2A
  002B                31     ES1_CONT_S EQU 0x2B
                      32             ;2
  002C                33     ES2_CONT_MS EQU 0x2C
  002D                34     ES2_CONT1_S EQU 0x2D
  002E                35     ES2_CONT2_S EQU 0x2E
                      36     
                      37     ;=======================INICIO====================
0000                  38     ORG 0X0000
0000 017B             39             AJMP INICIO
                      40     
007B                  41     ORG 0x007b
007B                  42     INICIO:
007B 1190             43             ACALL INIT
007D                  44     MAIN:
007D 1181             45             ACALL FSM
007F 017D             46             AJMP MAIN
0081                  47     FSM:
0081 E520             48             MOV A, ESTADO
0083 23               49             RL A
0084 900088           50             MOV DPTR, #EST_TAB
0087 73               51             JMP @A+DPTR
0088                  52     EST_TAB:
0088 01E0             53             AJMP ESTADO0            ;REPOSO
008A 210D             54             AJMP ESTADO1            ;ESPERA
008C 218A             55             AJMP ESTADO2            ;CALENTAR
008E 412C             56             AJMP ESTADO3            ;TRANSICION
                      57     ;========================INIT=====================;
0090                  58     INIT:
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     2

                      59             ;JUST DEBUGGING!!!!!!!!
                      60                     ;MOV P0, #0
                      61                     ;MOV P2, #0
0090 75B000           62                     MOV P3, #0
                      63                     ;ACALL ENCENDER_TIMER
                      64                     ;ACALL ENCENDER_ADC
                      65     
                      66             ;VALORES INICIALES
0093 752000           67             MOV ESTADO, #0
0096 752100           68             MOV EVENTO, #0
0099 752200           69             MOV VALOR_DISPLAY, #0
009C 752300           70             MOV T_CONT1, #0
009F 752400           71             MOV T_CONT2, #0
00A2 752600           72             MOV CONT_ZUMB, #0
00A5 752700           73             MOV CONT_PARPADEO, #0
00A8 C229             74             CLR PARPADEO
                      75     
                      76             ;PUERTOS ENTRADA
00AA D2B0             77             SETB PLUS
00AC D2B1             78             SETB MINUS
00AE D2B2             79             SETB SWITCH
00B0 D2B5             80             SETB SENSOR
                      81     
                      82             ;PUERTOS SALIDA
00B2 C280             83             CLR P0.0
00B4 C281             84             CLR P0.1
00B6 C282             85             CLR P0.2
00B8 C283             86             CLR P0.3
00BA C284             87             CLR P0.4
00BC C285             88             CLR P0.5
00BE C286             89             CLR P0.6
00C0 C287             90             CLR P0.7
00C2 C2A0             91             CLR LED
00C4 C2A1             92             CLR ZUMBADOR
00C6 D2A1             93             SETB ZUMBADOR
                      94     
                      95             ;TIMER
00C8 438902           96             ORL TMOD, #00000010b
00CB 5389F2           97             ANL TMOD, #11110010b
00CE C228             98             CLR TICK
                      99     
                     100             ;VARIABLES DE ESTADOS
                     101                     ;1
00D0 752A00          102             MOV ES1_CONT_MS, #0
00D3 752B00          103             MOV ES1_CONT_S, #0
                     104                     ;2
00D6 752C00          105             MOV ES2_CONT_MS, #0
00D9 752D00          106             MOV ES2_CONT1_S, #0
00DC 752E00          107             MOV ES2_CONT2_S, #0
                     108     
00DF 22              109             RET
                     110     ;===================ESTADO0_REPOSO================;
00E0                 111     ESTADO0:
00E0 3104            112             ACALL ES0_GEN_EV
00E2 E521            113             MOV A, EVENTO
00E4 23              114             RL A
00E5 9000E9          115             MOV DPTR, #ES0_EV_TAB
00E8 73              116             JMP @A+DPTR
00E9                 117     ES0_EV_TAB:
00E9 01ED            118             AJMP ES0_EV0                    ;EVENTO VACIO
00EB 01F0            119             AJMP ES0_EV1                    ;ENCENDIDO
00ED                 120     ES0_EV0:                        ;EVENTO VACIO
00ED 613E            121             AJMP ACTIVAR_IDL
00EF 22              122             RET
00F0                 123     ES0_EV1:                        ;EVENTO ESPERA
                     124             ;PONER UN 0 EN PANTALLA
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     3

00F0 752200          125             MOV VALOR_DISPLAY, #0
00F3 51AA            126             ACALL UPDATE_DISPLAY
00F5 517C            127             ACALL ENCENDER_PARPADEO
                     128             ;LED ON
00F7 516E            129             ACALL ENCENDER_LED
                     130             ;ZUMBIDO ON - (SE APAGARA EN 200MS)
00F9 7123            131             ACALL ENCENDER_ZUMBADOR
                     132             ;ENCENDER TIMER
00FB 1156            133             ACALL ENCENDER_TIMER
                     134             ;CAMBIAR AL ESTADO 1
00FD 752001          135             MOV ESTADO, #1
                     136             ;CAMBIAR EL EVENTO AL 0
0100 752100          137             MOV EVENTO, #0
0103 22              138             RET
0104                 139     ES0_GEN_EV:
                     140             ;COMPROBAR SI SE HA PULSADO EL BOTON
0104 A2B2            141             MOV C, SWITCH
0106 5001            142             JNC ES0_SWITCH
0108 22              143             RET
0109                 144     ES0_SWITCH:
0109 752101          145             MOV EVENTO, #1
010C 22              146             RET
                     147     ;====================ESTADO1_ESPERA================
010D                 148     ESTADO1:
010D 3155            149             ACALL ES1_GEN_EV
010F E521            150             MOV A, EVENTO
0111 23              151             RL A
0112 900116          152             MOV DPTR, #ES1_EV_TAB
0115 73              153             JMP @A+DPTR
0116                 154     ES1_EV_TAB:
0116 211C            155             AJMP ES1_EV0
0118 211D            156             AJMP ES1_EV1
011A 213A            157             AJMP ES1_EV2
011C                 158     ES1_EV0:                        ;EVENTO VACIO
011C 22              159             RET
011D                 160     ES1_EV1:                        ;EVENTO REPOSO
                     161             ;RESETEAR VARIABLES DE ESTADO
011D 752A00          162             MOV ES1_CONT_MS, #0
0120 752B00          163             MOV ES1_CONT_S, #0
0123 752600          164             MOV CONT_ZUMB, #0
0126 752700          165             MOV CONT_PARPADEO, #0
                     166             ;
0129 51A3            167             ACALL APAGAR_DISPLAY
012B 5182            168             ACALL APAGAR_PARPADEO
012D 7129            169             ACALL APAGAR_ZUMBADOR
012F 5171            170             ACALL APAGAR_LED
0131 1168            171             ACALL APAGAR_TIMER
                     172     
0133 752000          173             MOV ESTADO, #0
0136 752100          174             MOV EVENTO, #0
0139 22              175             RET
013A                 176     ES1_EV2:                        ;EVENTO CALENTAR
                     177             ;RESETEAR VARIABLES DE ESTADO
013A 752A00          178             MOV ES1_CONT_MS, #0
013D 752B00          179             MOV ES1_CONT_S, #0
0140 752600          180             MOV CONT_ZUMB, #0
0143 752700          181             MOV CONT_PARPADEO, #0
                     182             ;
0146 5182            183             ACALL APAGAR_PARPADEO
0148 51A7            184             ACALL ENCENDER_DISPLAY
014A 7129            185             ACALL APAGAR_ZUMBADOR
                     186             ;ENCENDER PWM
014C 5174            187             ACALL ENCENDER_PWM
                     188     
014E 752002          189             MOV ESTADO, #2
0151 752100          190             MOV EVENTO, #0
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     4

0154 22              191             RET     
0155                 192     ES1_GEN_EV:
                     193             ;COMPROBAR SI SE HA PULSADO EL SWITCH
0155 A2B2            194             MOV C, SWITCH
0157 5009            195             JNC ES1_SWITCH
                     196             ;COMPROBAR SI SE HA COLOCADO RECIPIENTE
0159 A2B5            197             MOV C, SENSOR
015B 4009            198             JC ES1_SENSOR
                     199             ;COMPROBAR SI HA PASADO 100MS
015D A228            200             MOV C, TICK
015F 4009            201             JC ES1_TICK
0161 22              202             RET
0162                 203     ES1_SWITCH:                     ;SE DETECTA ON/OFF
0162 752101          204             MOV EVENTO, #1
0165 22              205             RET
0166                 206     ES1_SENSOR:                     ;SE DETECTA RECIPIENTE
0166 752102          207             MOV EVENTO, #2
0169 22              208             RET
016A                 209     ES1_TICK:                       ;PASA 100MS SIN RECIPIENTE
016A C228            210             CLR TICK
016C 052A            211             INC ES1_CONT_MS
016E 740A            212             MOV A, #10
0170 C3              213             CLR C
0171 952A            214             SUBB A, ES1_CONT_MS
0173 6001            215             JZ ES1_1S
0175 22              216             RET
0176                 217     ES1_1S:                         ;PASA 1S SIN RECIPIENTE
0176 752A00          218             MOV ES1_CONT_MS, #0
0179 052B            219             INC ES1_CONT_S
017B 740F            220             MOV A, #15
017D C3              221             CLR C
017E 952B            222             SUBB A, ES1_CONT_S
0180 6001            223             JZ ES1_15S
0182 22              224             RET
0183                 225     ES1_15S:                        ;PASA 15S SIN RECIPIENTE
0183 752B00          226             MOV ES1_CONT_S, #0
0186 752101          227             MOV EVENTO, #1
0189 22              228             RET
                     229     ;===================ESTADO2_CALENTAR===============
018A                 230     ESTADO2:
018A 31C1            231             ACALL ES2_GEN_EV
018C E521            232             MOV A, EVENTO
018E 23              233             RL A
018F 900193          234             MOV DPTR, #ES2_EV_TAB
0192 73              235             JMP @A+DPTR
0193                 236     ES2_EV_TAB:
0193 219B            237             AJMP ES2_EV0
0195 219C            238             AJMP ES2_EV1
0197 21A9            239             AJMP ES2_EV2
0199 21B5            240             AJMP ES2_EV3
019B                 241     ES2_EV0:                        ;EVENTO VACIO
019B 22              242             RET
019C                 243     ES2_EV1:                        ;EVENTO TRANSICION
                     244             ;ENCENDER ZUMBADOR
019C 7123            245             ACALL ENCENDER_ZUMBADOR
                     246             ;APAGAR LED
019E 5171            247             ACALL APAGAR_LED
                     248             ;ENCENDER ADC
01A0 1106            249             ACALL ENCENDER_ADC
                     250     
01A2 752003          251             MOV ESTADO, #3
01A5 752100          252             MOV EVENTO, #0          
01A8 22              253             RET
01A9                 254     ES2_EV2:
01A9 7400            255             MOV A, #0
01AB C3              256             CLR C
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     5

01AC 9522            257             SUBB A, VALOR_DISPLAY
01AE 6075            258             JZ ES2_NOTHING
01B0 1522            259             DEC VALOR_DISPLAY
01B2 51AA            260             ACALL UPDATE_DISPLAY
01B4 22              261             RET
01B5                 262     ES2_EV3:
01B5 740A            263             MOV A, #10
01B7 C3              264             CLR C
01B8 9522            265             SUBB A, VALOR_DISPLAY
01BA 6069            266             JZ ES2_NOTHING
01BC 0522            267             INC VALOR_DISPLAY
01BE 51AA            268             ACALL UPDATE_DISPLAY
01C0 22              269             RET
01C1                 270     ES2_GEN_EV:
                     271             ;SE HA PULSADO EL BOTON ON/OFF
01C1 A2B2            272             MOV C, SWITCH
01C3 500D            273             JNC ES2_SWITCH
                     274             ;SE HA PULSADO EL BOTON DE MENOS
01C5 A2B1            275             MOV C, MINUS
01C7 400D            276             JC ES2_MINUS
                     277             ;SE HA PULSADO EL BOTON DE MAS
01C9 A2B0            278             MOV C, PLUS
01CB 400C            279             JC ES2_PLUS
                     280             ;PASA 100MS SIN RECIPIENTE
01CD A228            281             MOV C, TICK
01CF 400B            282             JC ES2_TICK
01D1 22              283             RET
01D2                 284     ES2_SWITCH:
01D2 752101          285             MOV EVENTO, #1
01D5 22              286             RET
01D6                 287     ES2_MINUS:
01D6 752102          288             MOV EVENTO, #2
01D9                 289     ES2_PLUS:
01D9 752103          290             MOV EVENTO, #3
01DC                 291     ES2_TICK:
01DC C228            292             CLR TICK
01DE 052C            293             INC ES2_CONT_MS
01E0 740A            294             MOV A, #10
01E2 C3              295             CLR C
01E3 952C            296             SUBB A, ES2_CONT_MS
01E5 6001            297             JZ ES2_1S
01E7 22              298             RET
01E8                 299     ES2_1S:
01E8 752C00          300             MOV ES2_CONT_MS, #0
01EB 5101            301             ACALL ES2_SENSOR
01ED 22              302             RET
01EE                 303     ES2_30S:
01EE 752D00          304             MOV ES2_CONT1_S, #0
01F1 752E00          305             MOV ES2_CONT2_S, #0
01F4 752101          306             MOV EVENTO, #1
01F7 22              307             RET
01F8                 308     ES2_60S:
01F8 752D00          309             MOV ES2_CONT1_S, #0
01FB 752E00          310             MOV ES2_CONT2_S, #0
01FE 752101          311             MOV EVENTO, #1
0201                 312     ES2_SENSOR:
0201 A2B5            313             MOV C, SENSOR
0203 4002            314             JC ES2_SENSOR_ON
0205 5011            315             JNC ES2_SENSOR_OFF
0207                 316     ES2_SENSOR_ON:
0207 E522            317             MOV A, VALOR_DISPLAY
0209 701A            318             JNZ ES2_NOTHING
020B 752D00          319             MOV ES2_CONT1_S, #0
020E 052E            320             INC ES2_CONT2_S
0210 743C            321             MOV A, #60
0212 C3              322             CLR C
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     6

0213 952E            323             SUBB A, ES2_CONT2_S
0215 60E1            324             JZ ES2_60S
0217 22              325             RET
0218                 326     ES2_SENSOR_OFF:
0218 752E00          327             MOV ES2_CONT2_S, #0
021B 052D            328             INC ES2_CONT1_S
021D 741E            329             MOV A, #30
021F C3              330             CLR C
0220 952D            331             SUBB A, ES2_CONT1_S
0222 60CA            332             JZ ES2_30S
0224 22              333             RET
0225                 334     ES2_NOTHING:
0225 752D00          335             MOV ES2_CONT1_S, #0
0228 752D00          336             MOV ES2_CONT1_S, #0
022B 22              337             RET
                     338     ;==================ESTADO3_TRANSICION==============
022C                 339     ESTADO3:
022C 5143            340             ACALL ES3_GEN_EV
022E E521            341             MOV A, EVENTO
0230 23              342             RL A
0231 900235          343             MOV DPTR, #ES3_EV_TAB
0234 73              344             JMP @A+DPTR
0235                 345     ES3_EV_TAB:
0235 4139            346             AJMP ES3_EV0
0237 413A            347             AJMP ES3_EV1
0239                 348     ES3_EV0:                        ;EVENTO VACIO
0239 22              349             RET
023A                 350     ES3_EV1:                        ;EVENTO ESPERA
023A 7129            351             ACALL APAGAR_ZUMBADOR
023C 752000          352             MOV ESTADO, #0
023F 752100          353             MOV EVENTO, #0
0242 22              354             RET
0243                 355     ES3_GEN_EV:
0243 A22A            356             MOV C, FADC
0245 4001            357             JC ES3_ADC
0247 22              358             RET
0248                 359     ES3_ADC:
0248 1114            360             ACALL LEER_ADC          ;AHORA TENGO EN B EL VALOR DEL ADC
                     361             
                     362             ;MENOS DE 40
024A E5F0            363             MOV A, B
024C C3              364             CLR C
024D 9428            365             SUBB A, #40
024F 4009            366             JC ES3_40
                     367             ;MAS DE 80
0251 E5F0            368             MOV A, B
0253 C3              369             CLR C
0254 9450            370             SUBB A, #80
0256 500E            371             JNC ES3_80
                     372             ;ENTRE 40 Y 80
0258 415E            373             AJMP ES3_60
025A                 374     ES3_40:
025A 752101          375             MOV EVENTO, #1
025D 22              376             RET
025E                 377     ES3_60:
025E 75220B          378             MOV VALOR_DISPLAY, #11
0261 51AA            379             ACALL UPDATE_DISPLAY
0263 1106            380             ACALL ENCENDER_ADC
0265 22              381             RET
0266                 382     ES3_80:
0266 75220C          383             MOV VALOR_DISPLAY, #12
0269 51AA            384             ACALL UPDATE_DISPLAY
026B 1106            385             ACALL ENCENDER_ADC
026D 22              386             RET
                     387     
                     388     ;=========================LED======================
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     7

026E                 389     ENCENDER_LED:   
026E D2A0            390             SETB LED
0270 22              391             RET
0271                 392     APAGAR_LED:
0271 C2A0            393             CLR LED
0273 22              394             RET
                     395     ;=========================PWM======================
0274                 396     ENCENDER_PWM:
0274 75FE01          397             MOV PWMP, #1
0277 22              398             RET
0278                 399     APAGAR_PWM:
0278 75FE00          400             MOV PWMP, #0
027B 22              401             RET
                     402     ;=======================DISPLAY====================
027C                 403     ENCENDER_PARPADEO:
027C 752700          404             MOV CONT_PARPADEO, #0
027F D229            405             SETB PARPADEO
0281 22              406             RET
0282                 407     APAGAR_PARPADEO:
0282 752700          408             MOV CONT_PARPADEO, #0
0285 C229            409             CLR PARPADEO
0287 22              410             RET
0288                 411     ESTADO_PARPADEO:
0288 A229            412             MOV C, PARPADEO
028A 4001            413             JC PARPADEO_500MS
028C 22              414             RET
028D                 415     PARPADEO_500MS:
                     416             ;HAN PASADO 500MS?
028D 0527            417             INC CONT_PARPADEO
028F 7405            418             MOV A, #5
0291 C3              419             CLR C
0292 9527            420             SUBB A, CONT_PARPADEO
0294 6001            421             JZ UPDATE_PARPADEO
0296 22              422             RET
0297                 423     UPDATE_PARPADEO:
0297 752700          424             MOV CONT_PARPADEO, #0
029A E580            425             MOV A, P0
029C 547F            426             ANL A, #01111111b
029E 7003            427             JNZ APAGAR_DISPLAY
02A0 6005            428             JZ ENCENDER_DISPLAY
02A2 22              429             RET
02A3                 430     APAGAR_DISPLAY:
02A3 538000          431             ANL P0, #0000000b
02A6 22              432             RET
02A7                 433     ENCENDER_DISPLAY:
02A7 51AA            434             ACALL UPDATE_DISPLAY
02A9 22              435             RET
02AA                 436     UPDATE_DISPLAY:
02AA 538000          437             ANL P0, #00000000b
02AD E522            438             MOV A, VALOR_DISPLAY
02AF 23              439             RL A
02B0 9002B4          440             MOV DPTR, #DISPLAY_FUNC
02B3 73              441             JMP @A+DPTR
02B4                 442     DISPLAY_FUNC:
02B4 41CE            443             AJMP DISPLAY_0  ;0
02B6 41D5            444             AJMP DISPLAY_1  ;1
02B8 41DC            445             AJMP DISPLAY_2  ;2
02BA 41E3            446             AJMP DISPLAY_3  ;3
02BC 41EA            447             AJMP DISPLAY_4  ;4
02BE 41F1            448             AJMP DISPLAY_5  ;5
02C0 41F8            449             AJMP DISPLAY_6  ;6
02C2 41FF            450             AJMP DISPLAY_7  ;7
02C4 6106            451             AJMP DISPLAY_8  ;8
02C6 610D            452             AJMP DISPLAY_9  ;9
02C8 6114            453             AJMP DISPLAY_P  ;10
02CA 611B            454             AJMP DISPLAY_H  ;11
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     8

02CC 611F            455             AJMP DISPLAY_HH ;12
02CE                 456     DISPLAY_0:      ;*gfedcba
02CE 43803F          457             ORL P0, #00111111b
02D1 75FCFF          458             MOV PWM0, #255          ;0%
02D4 22              459             RET
02D5                 460     DISPLAY_1:
02D5 438006          461             ORL P0, #00000110b
02D8 75FCE6          462             MOV PWM0, #230          ;10%
02DB 22              463             RET
02DC                 464     DISPLAY_2:
02DC 43805B          465             ORL P0, #01011011b
02DF 75FCCC          466             MOV PWM0, #204          ;20%
02E2 22              467             RET
02E3                 468     DISPLAY_3:
02E3 43804F          469             ORL P0, #01001111b
02E6 75FCB2          470             MOV PWM0, #178          ;30%
02E9 22              471             RET
02EA                 472     DISPLAY_4:
02EA 43807F          473             ORL P0, #01111111b
02ED 75FC99          474             MOV PWM0, #153          ;40%
02F0 22              475             RET
02F1                 476     DISPLAY_5:
02F1 43806D          477             ORL P0, #01101101b
02F4 857FFC          478             MOV PWM0, 127           ;50%
02F7 22              479             RET
02F8                 480     DISPLAY_6:
02F8 43807D          481             ORL P0, #01111101b
02FB 75FC66          482             MOV PWM0, #102          ;60%
02FE 22              483             RET
02FF                 484     DISPLAY_7:
02FF 43800F          485             ORL P0, #00001111b
0302 75FC4E          486             MOV PWM0, #78           ;70%
0305 22              487             RET
0306                 488     DISPLAY_8:
0306 43807F          489             ORL P0, #01111111b
0309 75FC34          490             MOV PWM0, #52           ;80%
030C 22              491             RET
030D                 492     DISPLAY_9:
030D 43806F          493             ORL P0, #01101111b
0310 75FC1A          494             MOV PWM0, #26           ;90%
0313 22              495             RET
0314                 496     DISPLAY_P:
0314 438073          497             ORL P0, #01110011b
0317 75FC00          498             MOV PWM0, #0            ;100%
031A 22              499             RET
031B                 500     DISPLAY_H:
031B 438074          501             ORL P0, #01110100b
031E 22              502             RET
031F                 503     DISPLAY_HH:
031F 438076          504             ORL P0, #01110110b
0322 22              505             RET
                     506     ;======================ZUMBADOR====================
0323                 507     ENCENDER_ZUMBADOR:
0323 752600          508             MOV CONT_ZUMB, #0
0326 C2A1            509             CLR ZUMBADOR
0328 22              510             RET
0329                 511     APAGAR_ZUMBADOR:
0329 752600          512             MOV CONT_ZUMB, #0
032C D2A1            513             SETB ZUMBADOR
032E 22              514             RET
032F                 515     ZUMBADOR_ESTADO:
                     516             ;ESTA EL ZUMBADOR ENCENDIDO?
032F A2A1            517             MOV C, ZUMBADOR
0331 5001            518             JNC ZUMBADOR_200MS
0333 22              519             RET
0334                 520     ZUMBADOR_200MS:
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE     9

0334 0526            521             INC CONT_ZUMB
0336 7402            522             MOV A, #2
0338 C3              523             CLR C
0339 9526            524             SUBB A, CONT_ZUMB
033B 60EC            525             JZ APAGAR_ZUMBADOR
033D 22              526             RET
                     527     ;===================PCON + External===============
033E                 528     ACTIVAR_IDL:
033E 43A881          529             ORL IEN0, #10000001b
0341 438701          530             ORL PCON, #00000001b 
0344 22              531             RET     
0345                 532     DESACTIVAR_IDL:
0345 53A800          533             ANL IEN0, #00000000b
0348 538700          534             ANL PCON, #00000000b
034B 22              535             RET
0003                 536     ORG 0x03
0003                 537     INTERRUPCION_EXTERNA:
0003 7145            538             ACALL DESACTIVAR_IDL
0005 32              539             RETI
                     540     ;=========================ADC======================
0006                 541     ENCENDER_ADC:
0006 43A8C0          542             ORL IEN0,#11000000b
0009 53C5F9          543             ANL ADCON, #11111001b
000C 43C509          544             ORL ADCON, #00001001b
000F 22              545             RET     
0010                 546     APAGAR_ADC:
0010 53A800          547             ANL IEN0, #00000000b
0013 22              548             RET
0014                 549     LEER_ADC:
0014 C22A            550             CLR FADC
0016 85FEF0          551             MOV B, ADCH
0019 22              552             RET
0053                 553     ORG 0x53
0053                 554     INTERRUPCION_ADC:       
0053 D22A            555             SETB FADC
0055 32              556             RETI
                     557     ;========================TIMER=====================
0056                 558     ENCENDER_TIMER:
0056 43A882          559             ORL IEN0, #10000010b
0059 758C06          560             MOV TH0, #6
005C 758A06          561             MOV TL0, #6
005F 752300          562             MOV T_CONT1, #0
0062 752400          563             MOV T_CONT2, #0
0065 D28C            564             SETB TR0
0067 22              565             RET
0068                 566     APAGAR_TIMER:
0068 53A800          567             ANL IEN0, #00000000b
006B C28C            568             CLR TR0
006D 22              569             RET
000B                 570     ORG 0x0B
000B                 571     INTERRUPCION_TIMER:
000B 110E            572             ACALL TIMER_FUNC
000D 32              573             RETI
                     574     
000E                 575     TIMER_FUNC:
000E C0D0            576             PUSH PSW
0010 C0E0            577             PUSH ACC
                     578     
0012 0523            579             INC T_CONT1
0014 747F            580             MOV A, #127
0016 C3              581             CLR C
0017 9523            582             SUBB A, T_CONT1
0019 701A            583             JNZ CONDTIMER
                     584     
001B 752300          585             MOV T_CONT1, #0
001E 0524            586             INC T_CONT2
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE    10

0020 7464            587             MOV A, #100
0022 C3              588             CLR C
0023 9524            589             SUBB A, T_CONT2
0025 700E            590             JNZ CONDTIMER
                     591     
0027 752400          592             MOV T_CONT2, #0
002A D228            593             SETB TICK                       ;HA PASADO 100ms!
                     594     
002C 712F            595             ACALL ZUMBADOR_ESTADO
002E 5188            596             ACALL ESTADO_PARPADEO
                     597     
0030 D0E0            598             POP ACC
0032 D0D0            599             POP PSW
0034 22              600             RET
0035                 601     CONDTIMER:
0035 D0E0            602             POP ACC
0037 D0D0            603             POP PSW
0039 22              604             RET
                     605     ;========================END======================
                     606     END
                             
                             ;HA FECHA 13/10/2022 SOLO YO Y DIOS SABIAMOS LO QUE AQUI HABIA ESCRITO.
                             ;CUENDO ESTES LEYENDO ESTO, SEGURAMENTE, SOLO DIOS LO SEPA.
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE    11

SYMBOL TABLE LISTING
------ ----- -------


N A M E               T Y P E  V A L U E   ATTRIBUTES

ACC. . . . . . . . .  D ADDR   00E0H   A   
ACTIVAR_IDL. . . . .  C ADDR   033EH   A   
ADCH . . . . . . . .  N NUMB   00FEH   A   
ADCON. . . . . . . .  N NUMB   00C5H   A   
APAGAR_ADC . . . . .  C ADDR   0010H   A   
APAGAR_DISPLAY . . .  C ADDR   02A3H   A   
APAGAR_LED . . . . .  C ADDR   0271H   A   
APAGAR_PARPADEO. . .  C ADDR   0282H   A   
APAGAR_PWM . . . . .  C ADDR   0278H   A   
APAGAR_TIMER . . . .  C ADDR   0068H   A   
APAGAR_ZUMBADOR. . .  C ADDR   0329H   A   
B. . . . . . . . . .  D ADDR   00F0H   A   
CONDTIMER. . . . . .  C ADDR   0035H   A   
CONT_PARPADEO. . . .  N NUMB   0027H   A   
CONT_ZUMB. . . . . .  N NUMB   0026H   A   
DESACTIVAR_IDL . . .  C ADDR   0345H   A   
DISPLAY_0. . . . . .  C ADDR   02CEH   A   
DISPLAY_1. . . . . .  C ADDR   02D5H   A   
DISPLAY_2. . . . . .  C ADDR   02DCH   A   
DISPLAY_3. . . . . .  C ADDR   02E3H   A   
DISPLAY_4. . . . . .  C ADDR   02EAH   A   
DISPLAY_5. . . . . .  C ADDR   02F1H   A   
DISPLAY_6. . . . . .  C ADDR   02F8H   A   
DISPLAY_7. . . . . .  C ADDR   02FFH   A   
DISPLAY_8. . . . . .  C ADDR   0306H   A   
DISPLAY_9. . . . . .  C ADDR   030DH   A   
DISPLAY_FUNC . . . .  C ADDR   02B4H   A   
DISPLAY_H. . . . . .  C ADDR   031BH   A   
DISPLAY_HH . . . . .  C ADDR   031FH   A   
DISPLAY_P. . . . . .  C ADDR   0314H   A   
ENCENDER_ADC . . . .  C ADDR   0006H   A   
ENCENDER_DISPLAY . .  C ADDR   02A7H   A   
ENCENDER_LED . . . .  C ADDR   026EH   A   
ENCENDER_PARPADEO. .  C ADDR   027CH   A   
ENCENDER_PWM . . . .  C ADDR   0274H   A   
ENCENDER_TIMER . . .  C ADDR   0056H   A   
ENCENDER_ZUMBADOR. .  C ADDR   0323H   A   
ES0_EV0. . . . . . .  C ADDR   00EDH   A   
ES0_EV1. . . . . . .  C ADDR   00F0H   A   
ES0_EV_TAB . . . . .  C ADDR   00E9H   A   
ES0_GEN_EV . . . . .  C ADDR   0104H   A   
ES0_SWITCH . . . . .  C ADDR   0109H   A   
ES1_15S. . . . . . .  C ADDR   0183H   A   
ES1_1S . . . . . . .  C ADDR   0176H   A   
ES1_CONT_MS. . . . .  N NUMB   002AH   A   
ES1_CONT_S . . . . .  N NUMB   002BH   A   
ES1_EV0. . . . . . .  C ADDR   011CH   A   
ES1_EV1. . . . . . .  C ADDR   011DH   A   
ES1_EV2. . . . . . .  C ADDR   013AH   A   
ES1_EV_TAB . . . . .  C ADDR   0116H   A   
ES1_GEN_EV . . . . .  C ADDR   0155H   A   
ES1_SENSOR . . . . .  C ADDR   0166H   A   
ES1_SWITCH . . . . .  C ADDR   0162H   A   
ES1_TICK . . . . . .  C ADDR   016AH   A   
ES2_1S . . . . . . .  C ADDR   01E8H   A   
ES2_30S. . . . . . .  C ADDR   01EEH   A   
ES2_60S. . . . . . .  C ADDR   01F8H   A   
ES2_CONT1_S. . . . .  N NUMB   002DH   A   
ES2_CONT2_S. . . . .  N NUMB   002EH   A   
ES2_CONT_MS. . . . .  N NUMB   002CH   A   
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE    12

ES2_EV0. . . . . . .  C ADDR   019BH   A   
ES2_EV1. . . . . . .  C ADDR   019CH   A   
ES2_EV2. . . . . . .  C ADDR   01A9H   A   
ES2_EV3. . . . . . .  C ADDR   01B5H   A   
ES2_EV_TAB . . . . .  C ADDR   0193H   A   
ES2_GEN_EV . . . . .  C ADDR   01C1H   A   
ES2_MINUS. . . . . .  C ADDR   01D6H   A   
ES2_NOTHING. . . . .  C ADDR   0225H   A   
ES2_PLUS . . . . . .  C ADDR   01D9H   A   
ES2_SENSOR . . . . .  C ADDR   0201H   A   
ES2_SENSOR_OFF . . .  C ADDR   0218H   A   
ES2_SENSOR_ON. . . .  C ADDR   0207H   A   
ES2_SWITCH . . . . .  C ADDR   01D2H   A   
ES2_TICK . . . . . .  C ADDR   01DCH   A   
ES3_40 . . . . . . .  C ADDR   025AH   A   
ES3_60 . . . . . . .  C ADDR   025EH   A   
ES3_80 . . . . . . .  C ADDR   0266H   A   
ES3_ADC. . . . . . .  C ADDR   0248H   A   
ES3_EV0. . . . . . .  C ADDR   0239H   A   
ES3_EV1. . . . . . .  C ADDR   023AH   A   
ES3_EV_TAB . . . . .  C ADDR   0235H   A   
ES3_GEN_EV . . . . .  C ADDR   0243H   A   
ESTADO . . . . . . .  N NUMB   0020H   A   
ESTADO0. . . . . . .  C ADDR   00E0H   A   
ESTADO1. . . . . . .  C ADDR   010DH   A   
ESTADO2. . . . . . .  C ADDR   018AH   A   
ESTADO3. . . . . . .  C ADDR   022CH   A   
ESTADO_PARPADEO. . .  C ADDR   0288H   A   
EST_TAB. . . . . . .  C ADDR   0088H   A   
EVENTO . . . . . . .  N NUMB   0021H   A   
FADC . . . . . . . .  B ADDR   0025H.2 A   
FSM. . . . . . . . .  C ADDR   0081H   A   
IEN0 . . . . . . . .  N NUMB   00A8H   A   
INICIO . . . . . . .  C ADDR   007BH   A   
INIT . . . . . . . .  C ADDR   0090H   A   
INTERRUPCION_ADC . .  C ADDR   0053H   A   
INTERRUPCION_EXTERNA  C ADDR   0003H   A   
INTERRUPCION_TIMER .  C ADDR   000BH   A   
LED. . . . . . . . .  B ADDR   00A0H.0 A   
LEER_ADC . . . . . .  C ADDR   0014H   A   
MAIN . . . . . . . .  C ADDR   007DH   A   
MINUS. . . . . . . .  B ADDR   00B0H.1 A   
P0 . . . . . . . . .  D ADDR   0080H   A   
P2 . . . . . . . . .  D ADDR   00A0H   A   
P3 . . . . . . . . .  D ADDR   00B0H   A   
PARPADEO . . . . . .  B ADDR   0025H.1 A   
PARPADEO_500MS . . .  C ADDR   028DH   A   
PCON . . . . . . . .  D ADDR   0087H   A   
PLUS . . . . . . . .  B ADDR   00B0H.0 A   
PSW. . . . . . . . .  D ADDR   00D0H   A   
PWM0 . . . . . . . .  N NUMB   00FCH   A   
PWMP . . . . . . . .  N NUMB   00FEH   A   
SENSOR . . . . . . .  B ADDR   00B0H.5 A   
SWITCH . . . . . . .  B ADDR   00B0H.2 A   
TH0. . . . . . . . .  D ADDR   008CH   A   
TICK . . . . . . . .  B ADDR   0025H.0 A   
TIMER_FUNC . . . . .  C ADDR   000EH   A   
TL0. . . . . . . . .  D ADDR   008AH   A   
TMOD . . . . . . . .  D ADDR   0089H   A   
TR0. . . . . . . . .  B ADDR   0088H.4 A   
T_CONT1. . . . . . .  N NUMB   0023H   A   
T_CONT2. . . . . . .  N NUMB   0024H   A   
UPDATE_DISPLAY . . .  C ADDR   02AAH   A   
UPDATE_PARPADEO. . .  C ADDR   0297H   A   
VALOR_DISPLAY. . . .  N NUMB   0022H   A   
ZUMBADOR . . . . . .  B ADDR   00A0H.1 A   
A51 MACRO ASSEMBLER  PROYECTO                                                             10/18/2022 14:20:01 PAGE    13

ZUMBADOR_200MS . . .  C ADDR   0334H   A   
ZUMBADOR_ESTADO. . .  C ADDR   032FH   A   


REGISTER BANK(S) USED: 0 


ASSEMBLY COMPLETE.  0 WARNING(S), 0 ERROR(S)
